# üí∞ V√≠ D·ª• C·ª• Th·ªÉ: X·ª≠ L√Ω Ti·ªÅn V·ªõi Khuy·∫øn M√£i S√†n

## üìã Th√¥ng Tin ƒê∆°n H√†ng M·∫´u

### Gi·∫£ ƒê·ªãnh:
- **Product Price (Gi√° g·ªëc s·∫£n ph·∫©m):** 2,000,000 VND
- **Store Discount (M√£ gi·∫£m gi√° c·ªßa shop):** 100,000 VND
- **Platform Discount (M√£ gi·∫£m gi√° c·ªßa s√†n):** 200,000 VND ‚≠ê
- **Shipping Fee (Ph√≠ ship):** 50,000 VND

### T√≠nh To√°n C∆° B·∫£n:
```
T·ªïng kh√°ch thanh to√°n = Product Price - Store Discount - Platform Discount + Shipping Fee
                     = 2,000,000 - 100,000 - 200,000 + 50,000
                     = 1,750,000 VND
```

### T√≠nh To√°n Cho Shop v√† Admin:
```
Base Amount (sau gi·∫£m gi√° shop) = Product Price - Store Discount
                                = 2,000,000 - 100,000
                                = 1,900,000 VND

Shop nh·∫≠n = 95% √ó Base Amount + Shipping Fee
         = 95% √ó 1,900,000 + 50,000
         = 1,805,000 + 50,000
         = 1,855,000 VND

Hoa h·ªìng s√†n = 5% √ó Base Amount
            = 5% √ó 1,900,000
            = 95,000 VND

Platform Discount Loss = 200,000 VND (Admin ph·∫£i ch·ªãu)
```

---

## üìä Tr·∫°ng Th√°i V√≠ Ban ƒê·∫ßu

### Shop Wallet:
- **Balance:** 5,000,000 VND
- **PendingAmount:** 1,855,000 VND (t·∫°m gi·ªØ khi t·∫°o ƒë∆°n)

### Admin Revenue:
- **T·ªïng Revenue:** 10,000,000 VND

### Kh√°ch H√†ng Wallet:
- **Balance:** 3,000,000 VND
- **ƒê√£ thanh to√°n:** 1,750,000 VND (cho ƒë∆°n h√†ng n√†y)

---

## üéØ Tr∆∞·ªùng H·ª£p 1: ‚úÖ ƒê∆°n H√†ng Th√†nh C√¥ng

### M√¥ T·∫£:
Kh√°ch h√†ng nh·∫≠n h√†ng v√† x√°c nh·∫≠n ho√†n t·∫•t ƒë∆°n h√†ng.

### X·ª≠ L√Ω Ti·ªÅn:

#### Shop:
```
Tr∆∞·ªõc:
  Balance: 5,000,000 VND
  PendingAmount: 1,855,000 VND

Sau khi chuy·ªÉn:
  Balance: 5,000,000 + 1,855,000 = 6,855,000 VND ‚úÖ
  PendingAmount: 0 VND ‚úÖ
```

#### Admin:
```
Tr∆∞·ªõc:
  Revenue: 10,000,000 VND

Sau khi c·ªông hoa h·ªìng v√† tr·ª´ discount:
  Revenue: 10,000,000 + 95,000 - 200,000 = 9,895,000 VND ‚úÖ
  
Chi ti·∫øt:
  + Hoa h·ªìng: +95,000 VND
  - Platform Discount Loss: -200,000 VND
  = T·ªïng: -105,000 VND (l·ªó do discount l·ªõn h∆°n hoa h·ªìng)
```

#### Kh√°ch H√†ng:
```
Kh√¥ng thay ƒë·ªïi (ƒë√£ thanh to√°n xong)
```

### ‚úÖ K·∫øt Qu·∫£:
- Shop nh·∫≠n: **1,855,000 VND** (ƒë√∫ng c√¥ng th·ª©c)
- Admin nh·∫≠n: **-105,000 VND** (l·ªó do discount s√†n l·ªõn)
- Kh√°ch ƒë√£ thanh to√°n: **1,750,000 VND**

---

## üîÑ Tr∆∞·ªùng H·ª£p 2: Shop X√°c Nh·∫≠n H√†ng Tr·∫£ V·ªÅ OK

### M√¥ T·∫£:
Shop nh·∫≠n l·∫°i h√†ng tr·∫£ v·ªÅ v√† x√°c nh·∫≠n h√†ng kh√¥ng c√≥ v·∫•n ƒë·ªÅ, ƒë·ªìng √Ω ho√†n ti·ªÅn.

### X·ª≠ L√Ω Ti·ªÅn:

#### Shop:
```
Tr∆∞·ªõc:
  Balance: 5,000,000 VND
  PendingAmount: 1,855,000 VND

Sau khi tr·ª´ pendingAmount:
  Balance: 5,000,000 VND (kh√¥ng ƒë·ªïi)
  PendingAmount: 0 VND ‚úÖ
  
Tr·ª´: -1,855,000 VND t·ª´ PendingAmount ‚úÖ
```

#### Admin:
```
Tr∆∞·ªõc:
  Revenue: 10,000,000 VND

Sau khi c·ªông hoa h·ªìng (ti·ªÅn ph·∫°t):
  Revenue: 10,000,000 + 95,000 = 10,095,000 VND ‚úÖ
  
Chi ti·∫øt:
  + Hoa h·ªìng (ti·ªÅn ph·∫°t shop): +95,000 VND
  (Kh√¥ng tr·ª´ platform discount v√¨ ƒë√¢y l√† ti·ªÅn ph·∫°t)
```

#### Kh√°ch H√†ng:
```
Tr∆∞·ªõc:
  Balance: 3,000,000 VND

Sau khi ho√†n ti·ªÅn:
  Balance: 3,000,000 + 1,750,000 = 4,750,000 VND ‚úÖ
  
Ho√†n ti·ªÅn: +1,750,000 VND (t·ªïng s·ªë ƒë√£ thanh to√°n)
```

### ‚úÖ K·∫øt Qu·∫£:
- Shop tr·ª´: **1,855,000 VND** t·ª´ PendingAmount (ƒë√∫ng c√¥ng th·ª©c)
- Admin nh·∫≠n: **+95,000 VND** (hoa h·ªìng - ti·ªÅn ph·∫°t)
- Kh√°ch nh·∫≠n: **+1,750,000 VND** (ho√†n ti·ªÅn ƒë·∫ßy ƒë·ªß)

---

## ‚úÖ Tr∆∞·ªùng H·ª£p 3: Admin Gi·∫£i Quy·∫øt - Shop Th·∫Øng

### M√¥ T·∫£:
Admin gi·∫£i quy·∫øt khi·∫øu n·∫°i v√† quy·∫øt ƒë·ªãnh shop th·∫Øng (h√†ng kh√¥ng c√≥ v·∫•n ƒë·ªÅ).

### X·ª≠ L√Ω Ti·ªÅn:

#### Shop:
```
Tr∆∞·ªõc:
  Balance: 5,000,000 VND
  PendingAmount: 1,855,000 VND

Sau khi chuy·ªÉn:
  Balance: 5,000,000 + 1,855,000 = 6,855,000 VND ‚úÖ
  PendingAmount: 0 VND ‚úÖ
```

#### Admin:
```
Tr∆∞·ªõc:
  Revenue: 10,000,000 VND

Sau khi c·ªông hoa h·ªìng v√† tr·ª´ discount:
  Revenue: 10,000,000 + 95,000 - 200,000 = 9,895,000 VND ‚úÖ
  
Chi ti·∫øt:
  + Hoa h·ªìng: +95,000 VND
  - Platform Discount Loss: -200,000 VND
  = T·ªïng: -105,000 VND
```

#### Kh√°ch H√†ng:
```
Kh√¥ng thay ƒë·ªïi (shop th·∫Øng, kh√¥ng ho√†n ti·ªÅn)
```

### ‚úÖ K·∫øt Qu·∫£:
- Shop nh·∫≠n: **1,855,000 VND** (ƒë√∫ng c√¥ng th·ª©c)
- Admin nh·∫≠n: **-105,000 VND** (l·ªó do discount s√†n)
- Kh√°ch: Kh√¥ng thay ƒë·ªïi

---

## ‚öñÔ∏è Tr∆∞·ªùng H·ª£p 4: Admin Gi·∫£i Quy·∫øt - Ho√†n Ti·ªÅn M·ªôt Ph·∫ßn

### M√¥ T·∫£:
Admin gi·∫£i quy·∫øt khi·∫øu n·∫°i v√† quy·∫øt ƒë·ªãnh ho√†n ti·ªÅn m·ªôt ph·∫ßn **500,000 VND** cho kh√°ch.

### X·ª≠ L√Ω Ti·ªÅn:

#### Shop:
```
Tr∆∞·ªõc:
  Balance: 5,000,000 VND
  PendingAmount: 1,855,000 VND

Sau khi x·ª≠ l√Ω:
  Tr·ª´ ho√†n ti·ªÅn: -500,000 VND t·ª´ PendingAmount
  Chuy·ªÉn ph·∫ßn c√≤n l·∫°i: +1,355,000 VND v√†o Balance
  
  Balance: 5,000,000 + 1,355,000 = 6,355,000 VND ‚úÖ
  PendingAmount: 0 VND ‚úÖ
  
Chi ti·∫øt:
  - Tr·ª´ ho√†n ti·ªÅn: -500,000 VND
  - Chuy·ªÉn v√†o Balance: +1,355,000 VND
  = T·ªïng: +855,000 VND (so v·ªõi ban ƒë·∫ßu)
```

#### Admin:
```
Tr∆∞·ªõc:
  Revenue: 10,000,000 VND

Sau khi c·ªông hoa h·ªìng v√† tr·ª´ discount:
  Revenue: 10,000,000 + 95,000 - 200,000 = 9,895,000 VND ‚úÖ
  
Chi ti·∫øt:
  + Hoa h·ªìng: +95,000 VND
  - Platform Discount Loss: -200,000 VND
  = T·ªïng: -105,000 VND
```

#### Kh√°ch H√†ng:
```
Tr∆∞·ªõc:
  Balance: 3,000,000 VND

Sau khi ho√†n ti·ªÅn m·ªôt ph·∫ßn:
  Balance: 3,000,000 + 500,000 = 3,500,000 VND ‚úÖ
  
Ho√†n ti·ªÅn: +500,000 VND
```

### ‚úÖ K·∫øt Qu·∫£:
- Shop nh·∫≠n: **1,355,000 VND** (1,855,000 - 500,000)
- Admin nh·∫≠n: **-105,000 VND** (l·ªó do discount s√†n)
- Kh√°ch nh·∫≠n: **+500,000 VND** (ho√†n ti·ªÅn m·ªôt ph·∫ßn)

### üìù Validation:
```
partialRefundAmount (500,000) < productPrice - storeDiscountAmount - platformCommission
500,000 < 2,000,000 - 100,000 - 95,000
500,000 < 1,805,000 ‚úÖ H·ª£p l·ªá
```

---

## ‚ùå Tr∆∞·ªùng H·ª£p 5: Admin Gi·∫£i Quy·∫øt - Kh√°ch Th·∫Øng

### M√¥ T·∫£:
Admin gi·∫£i quy·∫øt khi·∫øu n·∫°i v√† quy·∫øt ƒë·ªãnh kh√°ch th·∫Øng (h√†ng c√≥ v·∫•n ƒë·ªÅ).

### X·ª≠ L√Ω Ti·ªÅn:

#### Shop:
```
Tr∆∞·ªõc:
  Balance: 5,000,000 VND
  PendingAmount: 1,855,000 VND

Sau khi tr·ª´ pendingAmount:
  Balance: 5,000,000 VND (kh√¥ng ƒë·ªïi)
  PendingAmount: 0 VND ‚úÖ
  
Tr·ª´: -1,855,000 VND t·ª´ PendingAmount ‚úÖ
```

#### Admin:
```
Tr∆∞·ªõc:
  Revenue: 10,000,000 VND

Sau khi c·ªông hoa h·ªìng (ti·ªÅn ph·∫°t):
  Revenue: 10,000,000 + 95,000 = 10,095,000 VND ‚úÖ
  
Chi ti·∫øt:
  + Hoa h·ªìng (ti·ªÅn ph·∫°t shop): +95,000 VND
  (Kh√¥ng tr·ª´ platform discount v√¨ ƒë√¢y l√† ti·ªÅn ph·∫°t)
```

#### Kh√°ch H√†ng:
```
Tr∆∞·ªõc:
  Balance: 3,000,000 VND

Sau khi ho√†n ti·ªÅn ƒë·∫ßy ƒë·ªß:
  Balance: 3,000,000 + 1,750,000 = 4,750,000 VND ‚úÖ
  
Ho√†n ti·ªÅn: +1,750,000 VND (bao g·ªìm c·∫£ shippingFee)
```

### ‚úÖ K·∫øt Qu·∫£:
- Shop tr·ª´: **1,855,000 VND** t·ª´ PendingAmount (ƒë√∫ng c√¥ng th·ª©c)
- Admin nh·∫≠n: **+95,000 VND** (hoa h·ªìng - ti·ªÅn ph·∫°t)
- Kh√°ch nh·∫≠n: **+1,750,000 VND** (ho√†n ti·ªÅn ƒë·∫ßy ƒë·ªß bao g·ªìm shippingFee)

---

## üìä T·ªïng H·ª£p So S√°nh

| Tr∆∞·ªùng H·ª£p | Shop Nh·∫≠n/Tr·ª´ | Admin Nh·∫≠n/Tr·ª´ | Kh√°ch Nh·∫≠n | Ghi Ch√∫ |
|------------|---------------|----------------|------------|---------|
| **1. ƒê∆°n th√†nh c√¥ng** | +1,855,000 | -105,000 | 0 | L·ªó do discount s√†n l·ªõn |
| **2. Shop x√°c nh·∫≠n return OK** | -1,855,000 | +95,000 | +1,750,000 | Ti·ªÅn ph·∫°t shop |
| **3. Shop th·∫Øng dispute** | +1,855,000 | -105,000 | 0 | Gi·ªëng tr∆∞·ªùng h·ª£p 1 |
| **4. Ho√†n ti·ªÅn m·ªôt ph·∫ßn** | +1,355,000 | -105,000 | +500,000 | Tr·ª´ ho√†n ti·ªÅn t·ª´ shop |
| **5. Kh√°ch th·∫Øng dispute** | -1,855,000 | +95,000 | +1,750,000 | Gi·ªëng tr∆∞·ªùng h·ª£p 2 |

---

## üîç L∆∞u √ù Quan Tr·ªçng

### 1. Platform Discount (Khuy·∫øn M√£i S√†n):
- ‚ö†Ô∏è **Ch·ªâ ƒë∆∞·ª£c tr·ª´** khi ƒë∆°n h√†ng th√†nh c√¥ng ho·∫∑c shop th·∫Øng dispute
- ‚ùå **KH√îNG ƒë∆∞·ª£c tr·ª´** khi shop b·ªã ph·∫°t (tr∆∞·ªùng h·ª£p 2 v√† 5)
- üí° L√Ω do: ƒê√¢y l√† ti·ªÅn ph·∫°t shop, kh√¥ng li√™n quan ƒë·∫øn discount s√†n

### 2. Shipping Fee:
- ‚úÖ **Lu√¥n ƒë∆∞·ª£c c·ªông** v√†o s·ªë ti·ªÅn shop nh·∫≠n
- ‚úÖ **ƒê∆∞·ª£c ho√†n** cho kh√°ch khi ho√†n ti·ªÅn ƒë·∫ßy ƒë·ªß (tr∆∞·ªùng h·ª£p 2 v√† 5)
- ‚ùå **KH√îNG ƒë∆∞·ª£c ho√†n** khi ho√†n ti·ªÅn m·ªôt ph·∫ßn (tr∆∞·ªùng h·ª£p 4)

### 3. PendingAmount:
- üìå **Lu√¥n ƒë∆∞·ª£c t·∫°o** khi ƒë∆°n h√†ng ƒë∆∞·ª£c t·∫°o
- ‚úÖ **Chuy·ªÉn ‚Üí Balance** khi shop nh·∫≠n ti·ªÅn (tr∆∞·ªùng h·ª£p 1, 3, 4)
- ‚ùå **B·ªã tr·ª´** khi ho√†n ti·ªÅn cho kh√°ch (tr∆∞·ªùng h·ª£p 2, 5)

### 4. Hoa H·ªìng S√†n:
- üí∞ **Lu√¥n l√† 5%** c·ªßa (productPrice - storeDiscountAmount)
- ‚úÖ **ƒê∆∞·ª£c c·ªông** trong m·ªçi tr∆∞·ªùng h·ª£p
- ‚ö†Ô∏è **ƒê√≥ng vai tr√≤ ti·ªÅn ph·∫°t** khi shop b·ªã ph·∫°t (tr∆∞·ªùng h·ª£p 2 v√† 5)

---

## ‚úÖ K·∫øt Lu·∫≠n

V√≠ d·ª• tr√™n minh h·ªça r√µ r√†ng c√°ch x·ª≠ l√Ω ti·ªÅn trong c√°c tr∆∞·ªùng h·ª£p kh√°c nhau, ƒë·∫∑c bi·ªát l√† tr∆∞·ªùng h·ª£p c√≥ **khuy·∫øn m√£i s√†n (Platform Discount)**.

**ƒêi·ªÉm quan tr·ªçng:**
- Platform Discount ch·ªâ ƒë∆∞·ª£c tr·ª´ khi ƒë∆°n th√†nh c√¥ng/shop th·∫Øng
- Platform Discount kh√¥ng ƒë∆∞·ª£c tr·ª´ khi shop b·ªã ph·∫°t
- C√¥ng th·ª©c t√≠nh to√°n nh·∫•t qu√°n trong m·ªçi tr∆∞·ªùng h·ª£p

---

**Ng√†y t·∫°o:** 26/12/2024  
**Tr·∫°ng th√°i:** ‚úÖ HO√ÄN TH√ÄNH



